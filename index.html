<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="theme-color" content="#0ea5e9">
  <title>EVERYTINROOM POS</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;font-family:'Outfit',system-ui,sans-serif;background:linear-gradient(135deg,#f0f9ff 0%,#e0f2fe 100%);color:#0c4a6e;-webkit-font-smoothing:antialiased}
:root{--primary:#0ea5e9;--primary-dark:#0284c7;--secondary:#64748b;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444;--whatsapp:#25d366;--dark:#0f172a;--white:#ffffff;--glass:rgba(255,255,255,.85);--shadow:0 4px 24px -4px rgba(14,165,233,.15);--safe-top:env(safe-area-inset-top);--safe-bottom:env(safe-area-inset-bottom);--paystack:#00c3f7}
#loader{position:fixed;inset:0;background:linear-gradient(135deg,#0ea5e9,#0284c7);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px;opacity:0;pointer-events:none;transition:.3s}#loader.on{opacity:1;pointer-events:auto}#loader .spin{width:50px;height:50px;border:4px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}#loader p{color:#fff;font-size:16px;font-weight:600}@keyframes spin{to{transform:rotate(360deg)}}
#toast{position:fixed;top:100px;left:50%;transform:translateX(-50%) translateY(-30px);background:var(--dark);color:#fff;padding:16px 32px;border-radius:50px;font-size:15px;font-weight:600;z-index:9999;opacity:0;transition:.3s}#toast.on{opacity:1;transform:translateX(-50%) translateY(0)}#toast.success{background:linear-gradient(135deg,#22c55e,#16a34a)}#toast.error{background:linear-gradient(135deg,#ef4444,#dc2626)}
#login{position:fixed;inset:0;background:linear-gradient(135deg,#0ea5e9,#0284c7);display:flex;align-items:center;justify-content:center;padding:24px;z-index:1000}#login.hide{display:none}.login-wrap{text-align:center}.login-logo{width:100px;height:100px;background:rgba(255,255,255,.2);border-radius:30px;display:flex;align-items:center;justify-content:center;font-size:50px;margin:0 auto 24px}.login-wrap h1{color:#fff;font-size:32px;font-weight:800;margin-bottom:4px}.login-wrap>p{color:rgba(255,255,255,.8);font-size:15px;margin-bottom:40px}.login-card{background:var(--white);border-radius:28px;padding:40px 32px;max-width:380px;box-shadow:0 25px 80px rgba(0,0,0,.2)}.login-card h2{font-size:24px;font-weight:700;margin-bottom:8px}.login-card>p{color:#64748b;margin-bottom:32px}.pin-row{display:flex;gap:14px;justify-content:center;margin-bottom:24px}.pin-box{width:60px;height:70px;border:3px solid #e2e8f0;border-radius:16px;font-size:28px;font-weight:700;text-align:center;background:#f8fafc}.pin-box:focus{outline:none;border-color:var(--primary)}#loginErr{background:#fef2f2;color:#dc2626;padding:14px;border-radius:12px;margin-bottom:20px;display:none}#loginErr.on{display:block}
#app{display:none;min-height:100%}#app.on{display:block}
.topnav{display:none;position:fixed;top:0;left:0;right:0;height:72px;background:var(--glass);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.5);padding:0 32px;align-items:center;z-index:100}.topnav-logo{display:flex;align-items:center;gap:12px;font-size:20px;font-weight:800}.topnav-logo span{width:44px;height:44px;background:var(--primary);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px}.topnav-menu{display:flex;gap:4px;margin-left:32px;flex-wrap:wrap}.topnav-link{padding:8px 12px;border-radius:10px;font-size:12px;font-weight:600;color:#64748b;cursor:pointer;border:none;background:none;position:relative}.topnav-link:hover{background:rgba(14,165,233,.1);color:var(--primary)}.topnav-link.on{background:var(--primary);color:#fff}.topnav-link.wa{color:var(--whatsapp)}.topnav-link.wa.on{background:var(--whatsapp)}.topnav-badge{position:absolute;top:-4px;right:-4px;min-width:18px;height:18px;background:var(--danger);border-radius:9px;font-size:10px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center}.topnav-right{margin-left:auto;display:flex;align-items:center;gap:16px}.topnav-user{display:flex;align-items:center;gap:12px;padding:8px 16px 8px 8px;background:#f1f5f9;border-radius:50px}.topnav-avatar{width:38px;height:38px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}.topnav-logout{padding:10px 20px;background:#fee2e2;border-radius:50px;font-size:13px;font-weight:600;color:#dc2626;cursor:pointer;border:none}.adm{display:none!important}body.is-admin .adm{display:flex!important}
.mobhead{display:flex;position:fixed;top:0;left:0;right:0;height:calc(64px + var(--safe-top));padding-top:var(--safe-top);background:var(--glass);backdrop-filter:blur(20px);padding-left:16px;padding-right:16px;align-items:center;gap:12px;z-index:100}.mobhead-logo{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:800;flex:1}.mobhead-logo span{width:40px;height:40px;background:var(--primary);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}.mobhead-btn{width:44px;height:44px;border-radius:14px;background:#f1f5f9;display:flex;align-items:center;justify-content:center;font-size:20px;border:none;cursor:pointer;position:relative}.mobhead-badge{position:absolute;top:2px;right:2px;min-width:18px;height:18px;background:var(--danger);border-radius:9px;font-size:10px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center}
.mobnav{display:flex;position:fixed;bottom:0;left:0;right:0;background:var(--glass);backdrop-filter:blur(20px);padding:10px 20px calc(10px + var(--safe-bottom));z-index:100}.mobnav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;border-radius:14px;font-size:11px;font-weight:600;color:#94a3b8;border:none;background:none;cursor:pointer;position:relative}.mobnav-btn span{font-size:24px}.mobnav-btn.on{color:var(--primary);background:rgba(14,165,233,.1)}.mobnav-btn.wa.on{color:var(--whatsapp);background:rgba(37,211,102,.1)}.mobnav-badge{position:absolute;top:2px;right:50%;transform:translateX(14px);min-width:18px;height:18px;background:var(--danger);border-radius:9px;font-size:10px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center}
.cart-float{position:fixed;bottom:calc(100px + var(--safe-bottom));right:20px;width:64px;height:64px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;color:#fff;z-index:99;box-shadow:0 8px 30px rgba(14,165,233,.4);cursor:pointer;border:none}.cart-float-badge{position:absolute;top:0;right:0;min-width:24px;height:24px;background:var(--danger);border-radius:12px;font-size:12px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;border:3px solid #fff}
#menuBg{position:fixed;inset:0;background:rgba(15,23,42,.6);z-index:200;opacity:0;pointer-events:none;transition:.3s}#menuBg.on{opacity:1;pointer-events:auto}#menuDrawer{position:fixed;top:0;right:0;bottom:0;width:320px;max-width:85%;background:var(--white);z-index:201;transform:translateX(100%);transition:.3s;display:flex;flex-direction:column}#menuDrawer.on{transform:translateX(0)}.drawer-head{display:flex;align-items:center;justify-content:space-between;padding:20px;padding-top:calc(20px + var(--safe-top));border-bottom:1px solid #e2e8f0}.drawer-close{width:44px;height:44px;background:#f1f5f9;border-radius:12px;font-size:22px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center}.drawer-body{flex:1;overflow-y:auto;padding:20px}.drawer-user{background:var(--primary);border-radius:20px;padding:24px;text-align:center;margin-bottom:24px;color:#fff}.drawer-avatar{width:70px;height:70px;background:rgba(255,255,255,.2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:700;margin:0 auto 12px}.drawer-user h4{font-size:18px;font-weight:700}.drawer-badge{display:inline-block;padding:6px 14px;background:rgba(255,255,255,.2);border-radius:50px;font-size:11px;font-weight:700;margin-top:10px}.drawer-nav{display:flex;flex-direction:column;gap:6px}.drawer-link{display:flex;align-items:center;gap:14px;padding:16px;border-radius:14px;font-size:15px;font-weight:600;color:#64748b;border:none;background:none;cursor:pointer;text-align:left;width:100%;position:relative}.drawer-link span{font-size:22px;width:28px}.drawer-link.on{background:var(--primary);color:#fff}.drawer-link.wa.on{background:var(--whatsapp)}.drawer-link-badge{position:absolute;right:16px;min-width:24px;height:24px;background:var(--danger);border-radius:12px;font-size:12px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center}.drawer-foot{padding:20px;padding-bottom:calc(20px + var(--safe-bottom));border-top:1px solid #e2e8f0}.drawer-logout{width:100%;padding:16px;background:#fee2e2;border-radius:14px;font-size:15px;font-weight:600;color:#dc2626;border:none;cursor:pointer}
.main{padding-top:calc(64px + var(--safe-top));padding-bottom:calc(90px + var(--safe-bottom));min-height:100%}.container{padding:24px 16px;max-width:1200px;margin:0 auto}
.pg{display:none}.pg.on{display:block;animation:fadeIn .3s}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.pg-head{margin-bottom:28px}.pg-head-row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;margin-bottom:28px}.pg-title{font-size:28px;font-weight:800;margin-bottom:4px}.pg-sub{font-size:15px;color:#64748b}
.card{background:var(--white);border-radius:20px;padding:24px;margin-bottom:16px;box-shadow:var(--shadow)}.card-title{font-size:18px;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:28px}.stat{background:var(--white);border-radius:20px;padding:24px;box-shadow:var(--shadow)}.stat-icon{font-size:36px;margin-bottom:16px}.stat-label{font-size:13px;font-weight:600;color:#94a3b8;text-transform:uppercase}.stat-value{font-size:26px;font-weight:800;margin-top:4px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;height:48px;padding:0 20px;border-radius:14px;font-size:14px;font-weight:600;border:none;cursor:pointer;transition:.2s}.btn:active{transform:scale(.96)}.btn-primary{background:var(--primary);color:#fff}.btn-success{background:var(--success);color:#fff}.btn-danger{background:var(--danger);color:#fff}.btn-warning{background:var(--warning);color:#fff}.btn-whatsapp{background:var(--whatsapp);color:#fff}.btn-ghost{background:#f1f5f9;color:#64748b}.btn-sm{height:40px;padding:0 14px;font-size:13px;border-radius:10px}.btn-full{width:100%}
.field{margin-bottom:18px}.field-label{display:block;font-size:13px;font-weight:600;color:#64748b;margin-bottom:8px}.field-input{width:100%;height:52px;padding:0 16px;background:#f8fafc;border:2px solid #e2e8f0;border-radius:14px;font-size:16px}.field-input:focus{outline:none;border-color:var(--primary)}textarea.field-input{height:100px;padding:16px;resize:none}.field-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.badge{display:inline-block;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:700;text-transform:uppercase}.badge-success{background:rgba(34,197,94,.1);color:var(--success)}.badge-warning{background:rgba(245,158,11,.1);color:var(--warning)}.badge-danger{background:rgba(239,68,68,.1);color:var(--danger)}.badge-whatsapp{background:rgba(37,211,102,.1);color:#128c7e}.badge-slate{background:rgba(100,116,139,.15);color:#475569}.badge-primary{background:rgba(14,165,233,.1);color:var(--primary)}.badge-paystack{background:rgba(0,195,247,.1);color:#00c3f7}
.action-btns{display:flex;gap:8px;flex-wrap:wrap}
.tabs{display:flex;gap:10px;overflow-x:auto;margin-bottom:24px;padding-bottom:4px}.tab{height:44px;padding:0 20px;background:var(--white);border:2px solid #e2e8f0;border-radius:12px;font-size:14px;font-weight:600;color:#64748b;white-space:nowrap;cursor:pointer}.tab.on{background:var(--primary);color:#fff;border-color:transparent}.tab.wa.on{background:var(--whatsapp)}
.wa-orders{display:flex;flex-direction:column;gap:16px}.wa-order{background:var(--white);border-radius:20px;padding:20px;box-shadow:var(--shadow);border-left:4px solid var(--whatsapp)}.wa-order.completed{border-left-color:var(--success);opacity:.7}.wa-order.cancelled{border-left-color:var(--danger);opacity:.5}
.wa-order-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;flex-wrap:wrap;gap:10px}.wa-order-id{font-size:18px;font-weight:700}.wa-order-time{font-size:13px;color:#94a3b8}
.wa-order-badges{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.wa-order-status{padding:6px 14px;border-radius:50px;font-size:12px;font-weight:700}.wa-order-status.pending{background:rgba(37,211,102,.1);color:var(--whatsapp)}.wa-order-status.completed{background:rgba(34,197,94,.1);color:var(--success)}.wa-order-status.cancelled{background:rgba(239,68,68,.1);color:var(--danger)}
.wa-payment-status{padding:6px 14px;border-radius:50px;font-size:12px;font-weight:700}.wa-payment-status.paystack{background:rgba(0,195,247,.15);color:#0891b2}
.wa-order-customer{display:flex;align-items:center;gap:12px;padding:12px;background:#f8fafc;border-radius:12px;margin-bottom:12px}.wa-order-avatar{width:44px;height:44px;background:var(--whatsapp);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px}.wa-order-info h4{font-size:15px;font-weight:600}.wa-order-info p{font-size:13px;color:#64748b;margin-top:2px}
.wa-order-items{margin-bottom:12px}.wa-order-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #e2e8f0;font-size:14px}.wa-order-item:last-child{border-bottom:none}.wa-order-item span{color:#64748b}.wa-order-item b{color:var(--dark)}
.wa-order-footer{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:2px solid #f1f5f9;flex-wrap:wrap;gap:12px}.wa-order-total{font-size:20px;font-weight:800;color:var(--primary)}
.wa-order-address{font-size:13px;color:#64748b;background:#f8fafc;padding:10px 14px;border-radius:10px;margin-top:10px;display:flex;gap:8px}
.wa-paystack-ref{font-size:12px;color:#0891b2;background:rgba(0,195,247,.1);padding:6px 12px;border-radius:8px;margin-top:8px;display:inline-block}
.hero{background:var(--primary);border-radius:24px;padding:28px;color:#fff;margin-bottom:24px}.hero.wa{background:var(--whatsapp)}.hero.danger{background:var(--danger)}.hero.success{background:var(--success)}.hero small{font-size:15px;opacity:.8}.hero strong{display:block;font-size:36px;font-weight:800;margin-top:8px}
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}.product{background:var(--white);border-radius:18px;padding:14px;cursor:pointer;box-shadow:var(--shadow);border:2px solid transparent}.product:active{border-color:var(--primary)}.product.out{opacity:.4;pointer-events:none}.product-img{width:100%;height:100px;background:#f1f5f9;border-radius:12px;margin-bottom:12px;display:flex;align-items:center;justify-content:center;font-size:40px;overflow:hidden}.product-img img{width:100%;height:100%;object-fit:cover}.product-name{font-size:14px;font-weight:600;margin-bottom:8px}.product-price{font-size:20px;font-weight:800;color:var(--primary)}.product-stock{display:inline-flex;padding:5px 10px;border-radius:50px;font-size:11px;font-weight:700;margin-top:8px}.product-stock.ok{background:rgba(34,197,94,.1);color:var(--success)}.product-stock.low{background:rgba(245,158,11,.1);color:var(--warning)}.product-stock.out{background:rgba(239,68,68,.1);color:var(--danger)}
.cat-filter{display:flex;gap:10px;overflow-x:auto;margin-bottom:20px}.cat-chip{height:40px;padding:0 18px;background:var(--white);border:2px solid #e2e8f0;border-radius:50px;font-size:13px;font-weight:600;color:#64748b;white-space:nowrap;cursor:pointer}.cat-chip.on{background:var(--primary);color:#fff;border-color:transparent}
.modes{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px}.mode{height:80px;background:var(--white);border:3px solid #e2e8f0;border-radius:18px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;font-size:13px;font-weight:700;color:#94a3b8;cursor:pointer}.mode span{font-size:30px}.mode.on{border-color:var(--primary);color:var(--primary)}.mode.wh.on{border-color:var(--warning);color:var(--warning)}.mode.bu.on{border-color:var(--secondary);color:var(--secondary)}
.search-box{position:relative;margin-bottom:24px}.search-box input{padding-left:52px;height:56px;border-radius:16px}.search-box::before{content:'üîç';position:absolute;left:18px;top:50%;transform:translateY(-50%);font-size:20px}
.img-upload{margin-bottom:18px}.img-upload-area{width:100%;height:150px;background:#f8fafc;border:3px dashed #e2e8f0;border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;position:relative}.img-upload-area.has-img{border-style:solid;border-color:var(--success)}.img-upload-area img{width:100%;height:100%;object-fit:cover}.img-upload-area .placeholder{display:flex;flex-direction:column;align-items:center;gap:8px;color:#94a3b8}.img-upload-area .placeholder span{font-size:36px}.img-upload-input{display:none}.img-upload-remove{position:absolute;top:8px;right:8px;width:32px;height:32px;background:var(--danger);color:#fff;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0}.img-upload-area:hover .img-upload-remove{opacity:1}
#cartBg{position:fixed;inset:0;background:rgba(15,23,42,.6);z-index:300;opacity:0;pointer-events:none;transition:.3s}#cartBg.on{opacity:1;pointer-events:auto}#cartDrawer{position:fixed;bottom:0;left:0;right:0;background:var(--white);border-radius:28px 28px 0 0;max-height:92vh;z-index:301;transform:translateY(100%);transition:.35s;display:flex;flex-direction:column}#cartDrawer.on{transform:translateY(0)}.cart-bar{width:48px;height:5px;background:#e2e8f0;border-radius:3px;margin:14px auto}.cart-head{display:flex;align-items:center;justify-content:space-between;padding:0 24px 20px;border-bottom:1px solid #e2e8f0}.cart-head h3{font-size:20px;font-weight:800}.cart-count{background:var(--primary);color:#fff;padding:6px 14px;border-radius:50px;font-size:14px;font-weight:700}.cart-body{flex:1;overflow-y:auto;padding:20px 24px;max-height:40vh}.cart-item{display:flex;align-items:center;gap:12px;padding:14px;background:#f8fafc;border-radius:14px;margin-bottom:10px}.cart-item-img{width:48px;height:48px;background:#e2e8f0;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;overflow:hidden}.cart-item-img img{width:100%;height:100%;object-fit:cover}.cart-item-info{flex:1}.cart-item-name{font-size:14px;font-weight:600}.cart-qty{display:flex;align-items:center;gap:8px}.cart-qty-btn{width:36px;height:36px;border-radius:10px;background:#fff;border:2px solid #e2e8f0;font-size:18px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center}.cart-qty-num{font-size:15px;font-weight:700;min-width:24px;text-align:center}.cart-item-total{font-size:14px;font-weight:700;color:var(--primary)}.cart-item-del{width:36px;height:36px;border-radius:10px;background:#fee2e2;color:var(--danger);font-size:16px;display:flex;align-items:center;justify-content:center;border:none;cursor:pointer}.cart-empty{text-align:center;padding:40px;color:#94a3b8}.cart-empty span{font-size:56px;display:block;margin-bottom:12px;opacity:.4}.cart-foot{padding:20px;padding-bottom:calc(20px + var(--safe-bottom));border-top:1px solid #e2e8f0;background:#f8fafc}.cart-summary{margin-bottom:16px}.cart-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-size:14px;color:#64748b}.cart-row b{color:var(--dark)}.cart-row.total{font-size:20px;font-weight:800;padding-top:12px;border-top:2px dashed #e2e8f0}.cart-row.total b{color:var(--primary)}.disc-input{width:80px;height:40px;padding:0 10px;background:#fff;border:2px solid #e2e8f0;border-radius:10px;font-size:14px;font-weight:600;text-align:right}.phone-input{width:100%;height:50px;padding:0 16px;background:#fff;border:2px solid #e2e8f0;border-radius:12px;font-size:15px;margin-bottom:12px}.checkout-btn{width:100%;height:56px;background:var(--success);border-radius:14px;color:#fff;font-size:17px;font-weight:700;border:none;cursor:pointer}.checkout-btn:disabled{opacity:.5}
.modal{position:fixed;inset:0;z-index:400;display:none;align-items:flex-end;justify-content:center}.modal.on{display:flex}.modal-bg{position:absolute;inset:0;background:rgba(15,23,42,.6)}.modal-box{position:relative;background:var(--white);border-radius:28px 28px 0 0;width:100%;max-height:90vh;display:flex;flex-direction:column;animation:slideUp .3s}@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}.modal-head{display:flex;align-items:center;justify-content:space-between;padding:24px;border-bottom:1px solid #e2e8f0}.modal-head h3{font-size:20px;font-weight:700}.modal-close{width:44px;height:44px;background:#f1f5f9;border-radius:12px;font-size:22px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center}.modal-body{flex:1;overflow-y:auto;padding:24px}.modal-foot{padding:20px 24px calc(20px + var(--safe-bottom));border-top:1px solid #e2e8f0;display:flex;gap:12px}
.tbl-wrap{overflow-x:auto;margin:-24px;margin-top:0;padding:0 24px 24px}table{width:100%;border-collapse:collapse;min-width:400px}th{text-align:left;padding:14px 12px;background:#f8fafc;font-size:11px;font-weight:700;color:#64748b;text-transform:uppercase}td{padding:14px 12px;border-bottom:1px solid #f1f5f9;font-size:14px}.tbl-empty{text-align:center;padding:48px;color:#94a3b8}.tbl-empty span{font-size:56px;display:block;margin-bottom:12px;opacity:.3}
.report-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}.report-card{background:var(--white);border-radius:20px;padding:24px;box-shadow:var(--shadow)}.report-card h4{font-size:14px;font-weight:600;color:#64748b;margin-bottom:8px}.report-card .value{font-size:28px;font-weight:800;color:var(--dark)}.report-card .value.success{color:var(--success)}.report-card .value.danger{color:var(--danger)}
.weekly-chart{display:flex;align-items:flex-end;gap:8px;height:180px;padding:20px 0;border-bottom:2px solid #e2e8f0}.week-bar{flex:1;display:flex;flex-direction:column;align-items:center;gap:8px}.week-bar-fill{width:100%;background:linear-gradient(180deg,var(--primary),var(--primary-dark));border-radius:8px 8px 0 0;min-height:4px;transition:height .3s}.week-bar-label{font-size:11px;color:#64748b;font-weight:600;text-align:center}.week-bar-value{font-size:12px;font-weight:700;color:var(--dark)}.week-bar.current .week-bar-fill{background:linear-gradient(180deg,var(--success),#16a34a)}.week-bar.down .week-bar-fill{background:linear-gradient(180deg,var(--danger),#dc2626)}
.weekly-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:20px;padding-top:20px;border-top:1px solid #e2e8f0}.weekly-stat{text-align:center}.weekly-stat-label{font-size:12px;color:#64748b;margin-bottom:4px}.weekly-stat-value{font-size:20px;font-weight:800}.weekly-stat-value.up{color:var(--success)}.weekly-stat-value.down{color:var(--danger)}.weekly-stat-change{font-size:11px;margin-top:4px}.weekly-stat-change.up{color:var(--success)}.weekly-stat-change.down{color:var(--danger)}
.daily-chart{display:flex;align-items:flex-end;gap:6px;height:140px;padding:16px 0}.day-bar{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px}.day-bar-fill{width:100%;background:linear-gradient(180deg,var(--warning),#d97706);border-radius:6px 6px 0 0;min-height:4px;transition:height .3s}.day-bar-label{font-size:10px;color:#64748b;font-weight:600}.day-bar-value{font-size:11px;font-weight:700;color:var(--dark)}.day-bar.today .day-bar-fill{background:linear-gradient(180deg,var(--primary),var(--primary-dark))}
.top-product{display:flex;align-items:center;gap:12px;padding:12px;background:#f8fafc;border-radius:12px;margin-bottom:8px}.top-product-rank{width:28px;height:28px;background:var(--primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}.top-product-rank.gold{background:linear-gradient(135deg,#f59e0b,#d97706)}.top-product-rank.silver{background:linear-gradient(135deg,#94a3b8,#64748b)}.top-product-rank.bronze{background:linear-gradient(135deg,#d97706,#b45309)}.top-product-info{flex:1}.top-product-name{font-weight:600;font-size:14px}.top-product-qty{font-size:12px;color:#64748b}.top-product-total{font-weight:700;color:var(--primary)}
.bun-items-list{background:#f8fafc;border-radius:12px;padding:12px;min-height:60px}.bun-item{display:flex;align-items:center;gap:10px;padding:10px;background:#fff;border-radius:10px;margin-bottom:8px}.bun-item:last-child{margin-bottom:0}.bun-item-name{flex:1;font-weight:600;font-size:14px}.bun-item-price{font-size:13px;color:#64748b}.bun-item-qty{display:flex;align-items:center;gap:6px}.bun-item-qty input{width:50px;height:32px;text-align:center;border:2px solid #e2e8f0;border-radius:8px;font-size:14px;font-weight:600}.bun-item-del{width:28px;height:28px;background:#fee2e2;color:var(--danger);border:none;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px}.bun-empty{text-align:center;color:#94a3b8;padding:20px;font-size:13px}
.stock-item{display:flex;align-items:center;gap:16px;padding:16px;background:#f8fafc;border-radius:14px;margin-bottom:12px}.stock-item-info{flex:1}.stock-item-name{font-weight:600;margin-bottom:4px}.stock-item-current{font-size:13px;color:#64748b}.stock-item-input{width:80px;height:44px;text-align:center;font-size:16px;font-weight:700;border:2px solid #e2e8f0;border-radius:10px}.stock-item-input:focus{outline:none;border-color:var(--primary)}
@media(min-width:768px){.mobhead,.mobnav{display:none}#menuBg,#menuDrawer{display:none!important}.topnav{display:flex}.main{padding-top:72px;padding-bottom:40px}.container{padding:32px 40px}.cart-float{bottom:32px;right:32px}.stats{grid-template-columns:repeat(4,1fr)}.products{grid-template-columns:repeat(3,1fr);gap:20px}.modal{align-items:center;padding:32px}.modal-box{border-radius:24px;max-width:520px}#cartDrawer{max-width:440px;right:0;left:auto;border-radius:28px 0 0 28px;max-height:100vh}.report-grid{grid-template-columns:repeat(4,1fr)}}
@media(min-width:1024px){.products{grid-template-columns:repeat(4,1fr)}}
@media print{*{margin:0;padding:0;box-sizing:border-box}html,body{width:80mm;background:#fff!important;font-family:'Courier New',monospace!important;font-size:12px;color:#000!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}body *{visibility:hidden}#printReceipt,#printReceipt *{visibility:visible}#printReceipt{position:fixed;left:0;top:0;width:80mm;padding:2mm;background:#fff!important}.no-print{display:none!important}.receipt{width:100%;font-size:12px;line-height:1.4}.receipt-header{text-align:center;margin-bottom:3mm;border-bottom:1px dashed #000;padding-bottom:2mm}.receipt-logo{font-size:18px;font-weight:bold;margin-bottom:1mm}.receipt-info{font-size:10px}.receipt-title{text-align:center;font-weight:bold;margin:2mm 0;font-size:14px}.receipt-meta{margin-bottom:2mm;font-size:11px}.receipt-meta div{display:flex;justify-content:space-between}.receipt-items{border-top:1px dashed #000;border-bottom:1px dashed #000;padding:2mm 0;margin:2mm 0}.receipt-item{margin-bottom:1mm}.receipt-item-name{font-weight:bold}.receipt-item-detail{display:flex;justify-content:space-between;font-size:11px;padding-left:2mm}.receipt-totals{margin:2mm 0}.receipt-row{display:flex;justify-content:space-between;margin-bottom:1mm}.receipt-row.total{font-weight:bold;font-size:14px;border-top:1px dashed #000;padding-top:2mm;margin-top:2mm}.receipt-footer{text-align:center;margin-top:3mm;padding-top:2mm;border-top:1px dashed #000;font-size:10px}.receipt-barcode{text-align:center;font-family:'Libre Barcode 39',monospace;font-size:28px;margin:2mm 0}.receipt-qr{text-align:center;margin:2mm 0}}
.print-btn{background:#6366f1;color:#fff}
.held-cart{background:#f8fafc;border-radius:14px;padding:16px;margin-bottom:12px;border-left:4px solid var(--warning)}.held-cart-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.held-cart-name{font-weight:700;font-size:15px}.held-cart-time{font-size:12px;color:#94a3b8}.held-cart-items{font-size:13px;color:#64748b;margin-bottom:10px}.held-cart-total{font-size:18px;font-weight:800;color:var(--primary)}.held-cart-actions{display:flex;gap:8px;margin-top:12px}
#printReceipt{display:none}
@media screen{#printReceipt.preview{display:block;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:320px;max-height:90vh;overflow-y:auto;background:#fff;border-radius:12px;box-shadow:0 25px 50px rgba(0,0,0,.3);z-index:500;padding:20px}}
#printReceipt .close-preview{position:absolute;top:10px;right:10px;width:32px;height:32px;background:#f1f5f9;border:none;border-radius:8px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
@media print{#printReceipt .close-preview{display:none}}
  </style>
</head>
<body>
<div id="loader" class="on"><div class="spin"></div><p id="loaderText">Loading...</p></div>
<div id="toast"></div>
<div id="login"><div class="login-wrap"><div class="login-logo">üõí</div><h1>EVERYTINROOM</h1><p>& BEDTIME ‚Ä¢ Point of Sale</p><div class="login-card"><h2>Welcome Back!</h2><p>Enter your 4-digit PIN</p><div id="loginErr">Invalid PIN</div><div class="pin-row"><input type="tel" maxlength="1" class="pin-box" id="p1" oninput="pinInput(1)"><input type="tel" maxlength="1" class="pin-box" id="p2" oninput="pinInput(2)"><input type="tel" maxlength="1" class="pin-box" id="p3" oninput="pinInput(3)"><input type="tel" maxlength="1" class="pin-box" id="p4" oninput="pinInput(4)"></div></div></div></div>
<div id="app">
<nav class="topnav"><div class="topnav-logo"><span>üõí</span>EVERYTINROOM</div><div class="topnav-menu">
<button class="topnav-link adm on" data-pg="dash" onclick="goTo('dash')">üìä Dashboard</button>
<button class="topnav-link wa" data-pg="whatsapp" onclick="goTo('whatsapp')">üì± WhatsApp<span class="topnav-badge" id="waBadgeTop">0</span></button>
<button class="topnav-link" data-pg="pos" onclick="goTo('pos')">üõí POS</button>
<button class="topnav-link" data-pg="receipts" onclick="goTo('receipts')">üßæ Receipts</button>
<button class="topnav-link adm" data-pg="products" onclick="goTo('products')">üì¶ Products</button>
<button class="topnav-link adm" data-pg="bundles" onclick="goTo('bundles')">üéÅ Bundles</button>
<button class="topnav-link adm" data-pg="customers" onclick="goTo('customers')">üë• Customers</button>
<button class="topnav-link adm" data-pg="expenses" onclick="goTo('expenses')">üí∏ Expenses</button>
<button class="topnav-link adm" data-pg="stocktake" onclick="goTo('stocktake')">üìã Stock Take</button>
<button class="topnav-link adm" data-pg="reports" onclick="goTo('reports')">üìà Reports</button>
<button class="topnav-link adm" data-pg="staff" onclick="goTo('staff')">üë§ Staff</button>
</div><div class="topnav-right"><div class="topnav-user"><div class="topnav-avatar" id="topAv">A</div><span id="topNm">Admin</span></div><button class="topnav-logout" onclick="logout()">Sign Out</button></div></nav>
<header class="mobhead"><div class="mobhead-logo"><span>üõí</span>EVERYTINROOM</div><button class="mobhead-btn" onclick="goTo('whatsapp')" style="background:rgba(37,211,102,.1)">üì±<span class="mobhead-badge" id="waBadgeMob">0</span></button><button class="mobhead-btn" onclick="openMenu()">‚ò∞</button></header>
<button class="cart-float" onclick="openCart()">üõí<span class="cart-float-badge" id="cartBadge">0</span></button>
<div id="menuBg" onclick="closeMenu()"></div>
<div id="menuDrawer"><div class="drawer-head"><h3>Menu</h3><button class="drawer-close" onclick="closeMenu()">‚úï</button></div><div class="drawer-body"><div class="drawer-user"><div class="drawer-avatar" id="drAv">A</div><h4 id="drNm">Admin</h4><span class="drawer-badge" id="drBg">ADMIN</span></div><nav class="drawer-nav">
<button class="drawer-link adm on" data-pg="dash" onclick="goTo('dash')"><span>üìä</span>Dashboard</button>
<button class="drawer-link wa" data-pg="whatsapp" onclick="goTo('whatsapp')"><span>üì±</span>WhatsApp<span class="drawer-link-badge" id="waBadgeDr">0</span></button>
<button class="drawer-link" data-pg="pos" onclick="goTo('pos')"><span>üõí</span>Point of Sale</button>
<button class="drawer-link" data-pg="receipts" onclick="goTo('receipts')"><span>üßæ</span>Receipts</button>
<button class="drawer-link adm" data-pg="products" onclick="goTo('products')"><span>üì¶</span>Products</button>
<button class="drawer-link adm" data-pg="bundles" onclick="goTo('bundles')"><span>üéÅ</span>Bundles</button>
<button class="drawer-link adm" data-pg="customers" onclick="goTo('customers')"><span>üë•</span>Customers</button>
<button class="drawer-link adm" data-pg="expenses" onclick="goTo('expenses')"><span>üí∏</span>Expenses</button>
<button class="drawer-link adm" data-pg="stocktake" onclick="goTo('stocktake')"><span>üìã</span>Stock Take</button>
<button class="drawer-link adm" data-pg="reports" onclick="goTo('reports')"><span>üìà</span>Reports</button>
<button class="drawer-link adm" data-pg="staff" onclick="goTo('staff')"><span>üë§</span>Staff</button>
</nav></div><div class="drawer-foot"><button class="drawer-logout" onclick="logout()">üö™ Sign Out</button></div></div>
<nav class="mobnav">
<button class="mobnav-btn on" data-pg="pos" onclick="goTo('pos')"><span>üõí</span>Sale</button>
<button class="mobnav-btn wa" data-pg="whatsapp" onclick="goTo('whatsapp')"><span>üì±</span>WhatsApp<span class="mobnav-badge" id="waBadgeNav">0</span></button>
<button class="mobnav-btn" data-pg="receipts" onclick="goTo('receipts')"><span>üßæ</span>Receipts</button>
<button class="mobnav-btn adm" data-pg="dash" onclick="goTo('dash')"><span>üìä</span>More</button>
</nav>
<main class="main"><div class="container">
<section class="pg on" id="pgDash"><div class="pg-head"><h1 class="pg-title">Dashboard</h1><p class="pg-sub">Business overview</p></div>
<div class="stats"><div class="stat"><div class="stat-icon">üí∞</div><div class="stat-label">Today Sales</div><div class="stat-value" id="dToday">GHS 0</div></div><div class="stat"><div class="stat-icon">üíµ</div><div class="stat-label">Today Profit</div><div class="stat-value" id="dProfit">GHS 0</div></div><div class="stat"><div class="stat-icon">üì±</div><div class="stat-label">Pending Orders</div><div class="stat-value" id="dPending">0</div></div><div class="stat"><div class="stat-icon">üí≥</div><div class="stat-label">Paystack Orders</div><div class="stat-value" id="dPaystack">0</div></div></div>
</section>
<section class="pg" id="pgWhatsapp"><div class="pg-head-row"><div><h1 class="pg-title">üì± WhatsApp Orders</h1><p class="pg-sub">Paystack pre-paid orders</p></div><button class="btn btn-whatsapp" onclick="refreshWA()">üîÑ Refresh</button></div>
<div class="hero wa"><small>Pending Orders</small><strong id="waPendingCount">0</strong></div>
<div class="tabs" id="waTabs"><button class="tab wa on" onclick="setWAFilter('Pending')">üü¢ Pending</button><button class="tab" onclick="setWAFilter('Completed')">‚úÖ Completed</button><button class="tab" onclick="setWAFilter('all')">üìã All</button></div>
<div class="wa-orders" id="waOrders"></div>
</section>
<section class="pg" id="pgPos"><div class="pg-head"><h1 class="pg-title">Point of Sale</h1></div><div class="search-box"><input type="text" class="field-input" placeholder="Search products..." id="posQ" oninput="rPOS()"></div><div class="cat-filter" id="catFilter"></div><div class="modes"><button class="mode on" id="mdRet" onclick="setMode('retail')"><span>üõçÔ∏è</span>Retail</button><button class="mode wh" id="mdWho" onclick="setMode('wholesale')"><span>üè≠</span>Wholesale</button><button class="mode bu" id="mdBun" onclick="setMode('bundle')"><span>üéÅ</span>Bundle</button></div><div class="products" id="prodGrid"></div></section>
<section class="pg" id="pgReceipts"><div class="pg-head"><h1 class="pg-title">Receipts</h1></div><div class="card"><input type="text" class="field-input" placeholder="üîç Search..." id="rcQ" oninput="rReceipts()" style="margin-bottom:20px"><div class="tbl-wrap"><table><thead><tr><th>Receipt</th><th>Date</th><th>Customer</th><th>Type</th><th>Total</th><th>Print</th></tr></thead><tbody id="rcTbl"></tbody></table></div></div></section>
<section class="pg" id="pgProducts"><div class="pg-head-row"><div><h1 class="pg-title">Products</h1></div><button class="btn btn-primary" onclick="openPr()">‚ûï Add</button></div><div class="card"><input type="text" class="field-input" placeholder="üîç Search..." id="prQ" oninput="rProducts()" style="margin-bottom:20px"><div class="tbl-wrap"><table><thead><tr><th>Image</th><th>Product</th><th>Price</th><th>Stock</th><th>Actions</th></tr></thead><tbody id="prTbl"></tbody></table></div></div></section>
<section class="pg" id="pgCustomers"><div class="pg-head"><h1 class="pg-title">üë• Customers</h1><p class="pg-sub">Customer purchase history</p></div><div class="hero success"><small>Total Customers</small><strong id="custCount">0</strong></div><div class="card"><input type="text" class="field-input" placeholder="üîç Search by phone..." id="custQ" oninput="rCustomers()" style="margin-bottom:20px"><div class="tbl-wrap"><table><thead><tr><th>Phone</th><th>Visits</th><th>Total Spent</th><th>Last Visit</th></tr></thead><tbody id="custTbl"></tbody></table></div></div></section>
<section class="pg" id="pgBundles"><div class="pg-head-row"><div><h1 class="pg-title">üéÅ Bundles</h1><p class="pg-sub">Create product bundles at special prices</p></div><button class="btn btn-primary" onclick="openBun()">‚ûï Create Bundle</button></div><div class="card"><div class="tbl-wrap"><table><thead><tr><th>Bundle</th><th>Products</th><th>Bundle Price</th><th>Savings</th><th>Status</th><th>Actions</th></tr></thead><tbody id="bunTbl"></tbody></table></div></div></section>
<section class="pg" id="pgExpenses"><div class="pg-head-row"><div><h1 class="pg-title">üí∏ Expenses</h1><p class="pg-sub">Track business expenses</p></div><button class="btn btn-danger" onclick="openExp()">‚ûï Add Expense</button></div><div class="hero danger"><small>This Month Expenses</small><strong id="expMonthTotal">GHS 0</strong></div><div class="card"><div class="tbl-wrap"><table><thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead><tbody id="expTbl"></tbody></table></div></div></section>
<section class="pg" id="pgStocktake"><div class="pg-head-row"><div><h1 class="pg-title">üìã Stock Take</h1><p class="pg-sub">Count and update inventory</p></div><button class="btn btn-primary" onclick="openStockTake()">üìã New Stock Take</button></div><div class="card"><h3 class="card-title">üìú Stock Take History</h3><div class="tbl-wrap"><table><thead><tr><th>Date</th><th>Items Counted</th><th>Notes</th></tr></thead><tbody id="stTbl"></tbody></table></div></div></section>
<section class="pg" id="pgReports"><div class="pg-head"><h1 class="pg-title">üìà Reports</h1><p class="pg-sub">Business analytics</p></div><div class="field-row" style="margin-bottom:24px"><div class="field"><label class="field-label">From Date</label><input type="date" class="field-input" id="repFrom" onchange="rReports()"></div><div class="field"><label class="field-label">To Date</label><input type="date" class="field-input" id="repTo" onchange="rReports()"></div></div><div class="report-grid"><div class="report-card"><h4>üí∞ Total Sales</h4><div class="value" id="repSales">GHS 0</div></div><div class="report-card"><h4>üíµ Total Profit</h4><div class="value success" id="repProfit">GHS 0</div></div><div class="report-card"><h4>üí∏ Total Expenses</h4><div class="value danger" id="repExpenses">GHS 0</div></div><div class="report-card"><h4>üìä Net Profit</h4><div class="value" id="repNet">GHS 0</div></div><div class="report-card"><h4>üßæ Transactions</h4><div class="value" id="repTxn">0</div></div><div class="report-card"><h4>üì± WhatsApp Sales</h4><div class="value" id="repWA">GHS 0</div></div><div class="report-card"><h4>üè≠ Wholesale</h4><div class="value" id="repWhole">GHS 0</div></div><div class="report-card"><h4>üõçÔ∏è Retail</h4><div class="value" id="repRetail">GHS 0</div></div></div><div class="card" style="margin-top:24px"><h3 class="card-title">üìä Weekly Sales Trend</h3><div class="weekly-chart" id="weeklyChart"></div><div class="weekly-stats" id="weeklyStats"></div></div><div class="card" style="margin-top:16px"><h3 class="card-title">üìÖ Daily Sales This Week</h3><div class="daily-chart" id="dailyChart"></div></div><div class="card" style="margin-top:16px"><h3 class="card-title">üèÜ Top Selling Products</h3><div id="topProducts"></div></div></section>
<section class="pg" id="pgStaff"><div class="pg-head-row"><div><h1 class="pg-title">Staff</h1></div><button class="btn btn-primary" onclick="openSf()">‚ûï Add</button></div><div class="card"><div class="tbl-wrap"><table><thead><tr><th>Name</th><th>Role</th><th>Actions</th></tr></thead><tbody id="sfTbl"></tbody></table></div></div></section>
</div></main>
<div id="cartBg" onclick="closeCart()"></div>
<div id="cartDrawer"><div class="cart-bar"></div><div class="cart-head"><h3>üõí Cart <span class="cart-count" id="cartCnt">0</span></h3><div class="action-btns"><button class="btn btn-warning btn-sm" onclick="holdCart()">‚è∏Ô∏è Hold</button><button class="btn btn-primary btn-sm" onclick="openHeldCarts()" id="heldBtn" style="display:none">üìã <span id="heldCnt">0</span></button><button class="btn btn-danger btn-sm" onclick="clearCart()">Clear</button></div></div><div class="cart-body" id="cartBody"><div class="cart-empty"><span>üõí</span><p>Cart is empty</p></div></div><div class="cart-foot"><div class="cart-summary"><div class="cart-row"><span>Subtotal</span><b id="cartSub">GHS 0.00</b></div><div class="cart-row"><span>Discount</span><input type="number" class="disc-input" id="cartDisc" value="0" min="0" onchange="calcCart()"></div><div class="cart-row total"><span>Total</span><b id="cartTot">GHS 0.00</b></div></div><input type="tel" class="phone-input" placeholder="üì± Customer phone" id="cartPh"><button class="checkout-btn" id="payBtn" onclick="openPay()" disabled>‚úì Complete Sale</button></div></div>
</div>
<!-- Modals -->
<div class="modal" id="payModal"><div class="modal-bg" onclick="closeMod('payModal')"></div><div class="modal-box"><div class="modal-head"><h3>üí≥ Payment</h3><button class="modal-close" onclick="closeMod('payModal')">‚úï</button></div><div class="modal-body"><div class="field"><label class="field-label">Payment Method</label><select class="field-input" id="payMethod"><option value="Cash">üíµ Cash</option><option value="Momo">üì± Mobile Money</option></select></div><div class="hero" style="margin-top:20px"><small>Amount Due</small><strong id="payTotal">GHS 0</strong></div></div><div class="modal-foot"><button class="btn btn-success btn-full" onclick="completeSale()">‚úì Confirm</button></div></div></div>
<div class="modal" id="prModal"><div class="modal-bg" onclick="closeMod('prModal')"></div><div class="modal-box"><div class="modal-head"><h3 id="prModalTitle">Add Product</h3><button class="modal-close" onclick="closeMod('prModal')">‚úï</button></div><div class="modal-body"><input type="hidden" id="ePrId"><div class="img-upload"><div class="img-upload-area" id="imgUploadArea" onclick="$('prImgInput').click()"><div class="placeholder" id="imgPlaceholder"><span>üì∑</span><p>Upload</p></div><img id="imgPreview" style="display:none"><button type="button" class="img-upload-remove" onclick="event.stopPropagation();removeImg()">‚úï</button></div><input type="file" class="img-upload-input" id="prImgInput" accept="image/*" onchange="handleImgUpload(this)"></div><div class="field"><label class="field-label">Name</label><input type="text" class="field-input" id="prName"></div><div class="field"><label class="field-label">Category</label><input type="text" class="field-input" id="prCat"></div><div class="field-row"><div class="field"><label class="field-label">Cost</label><input type="number" class="field-input" id="prCost" min="0"></div><div class="field"><label class="field-label">Price</label><input type="number" class="field-input" id="prPrice" min="0"></div></div><div class="field-row"><div class="field"><label class="field-label">Wholesale</label><input type="number" class="field-input" id="prWhole" min="0"></div><div class="field"><label class="field-label">Stock</label><input type="number" class="field-input" id="prQty" min="0"></div></div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeMod('prModal')">Cancel</button><button class="btn btn-primary" onclick="savePr()">Save</button></div></div></div>
<div class="modal" id="sfModal"><div class="modal-bg" onclick="closeMod('sfModal')"></div><div class="modal-box"><div class="modal-head"><h3 id="sfModalTitle">Add Staff</h3><button class="modal-close" onclick="closeMod('sfModal')">‚úï</button></div><div class="modal-body"><input type="hidden" id="eSfId"><div class="field"><label class="field-label">Name</label><input type="text" class="field-input" id="sfName"></div><div class="field"><label class="field-label">Role</label><select class="field-input" id="sfRole"><option>Cashier</option><option>Admin</option></select></div><div class="field"><label class="field-label">PIN (4 digits)</label><input type="tel" class="field-input" id="sfPin" maxlength="4"></div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeMod('sfModal')">Cancel</button><button class="btn btn-primary" onclick="saveSf()">Save</button></div></div></div>
<div class="modal" id="expModal"><div class="modal-bg" onclick="closeMod('expModal')"></div><div class="modal-box"><div class="modal-head"><h3>üí∏ Add Expense</h3><button class="modal-close" onclick="closeMod('expModal')">‚úï</button></div><div class="modal-body"><div class="field"><label class="field-label">Date</label><input type="date" class="field-input" id="expDate"></div><div class="field"><label class="field-label">Category</label><select class="field-input" id="expCat"><option>Utilities</option><option>Rent</option><option>Supplies</option><option>Transport</option><option>Salaries</option><option>Other</option></select></div><div class="field"><label class="field-label">Description</label><input type="text" class="field-input" id="expDesc" placeholder="What was this expense for?"></div><div class="field"><label class="field-label">Amount (GHS)</label><input type="number" class="field-input" id="expAmt" min="0" step="0.01"></div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeMod('expModal')">Cancel</button><button class="btn btn-danger" onclick="saveExp()">üí∏ Add Expense</button></div></div></div>
<div class="modal" id="stModal"><div class="modal-bg" onclick="closeMod('stModal')"></div><div class="modal-box"><div class="modal-head"><h3>üìã Stock Take</h3><button class="modal-close" onclick="closeMod('stModal')">‚úï</button></div><div class="modal-body"><div class="field"><label class="field-label">Notes (optional)</label><textarea class="field-input" id="stNotes" placeholder="Any notes about this stock take..."></textarea></div><div id="stItems"></div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeMod('stModal')">Cancel</button><button class="btn btn-primary" onclick="saveStockTake()">üíæ Save Stock Take</button></div></div></div>
<div class="modal" id="heldModal"><div class="modal-bg" onclick="closeMod('heldModal')"></div><div class="modal-box"><div class="modal-head"><h3>üìã Held Carts</h3><button class="modal-close" onclick="closeMod('heldModal')">‚úï</button></div><div class="modal-body" id="heldCartsBody"><div class="tbl-empty"><span>üìã</span><p>No held carts</p></div></div></div></div>
<div class="modal" id="bunModal"><div class="modal-bg" onclick="closeMod('bunModal')"></div><div class="modal-box"><div class="modal-head"><h3 id="bunModalTitle">Create Bundle</h3><button class="modal-close" onclick="closeMod('bunModal')">‚úï</button></div><div class="modal-body"><input type="hidden" id="eBunId"><div class="field"><label class="field-label">Bundle Name</label><input type="text" class="field-input" id="bunName" placeholder="e.g. Bedroom Starter Pack"></div><div class="field"><label class="field-label">Bundle Price (GHS)</label><input type="number" class="field-input" id="bunPrice" min="0" step="0.01"></div><div class="field"><label class="field-label">Add Products to Bundle</label><select class="field-input" id="bunProdSelect" onchange="addToBundleList()"><option value="">-- Select Product --</option></select></div><div class="field"><label class="field-label">Bundle Items</label><div id="bunItemsList" class="bun-items-list"></div><p id="bunRetailTotal" style="font-size:13px;color:#64748b;margin-top:8px"></p></div><div class="field"><label class="field-label">Status</label><select class="field-input" id="bunActive"><option value="true">Active</option><option value="false">Inactive</option></select></div></div><div class="modal-foot"><button class="btn btn-ghost" onclick="closeMod('bunModal')">Cancel</button><button class="btn btn-primary" onclick="saveBun()">üíæ Save Bundle</button></div></div></div>
<div id="printReceipt"><button class="close-preview no-print" onclick="closePreview()">‚úï</button><div class="receipt" id="receiptContent"></div><div class="no-print" style="padding:16px;display:flex;gap:10px;justify-content:center"><button class="btn btn-primary" onclick="doPrint()">üñ®Ô∏è Print</button><button class="btn btn-ghost" onclick="closePreview()">Close</button></div></div>
<script>
const $=id=>document.getElementById(id),n=v=>parseFloat(v)||0,m=v=>'GHS '+n(v).toFixed(2);
let D={products:[],bundles:[],sales:[],staff:[],expenses:[],customers:[],stocktakes:[],whatsappOrders:[]};
let cart=[],user=null,admin=false,mode='retail',selectedCat='all',waFilter='Pending',currentImg='',existingImgUrl='',heldCarts=[];
const show=(t)=>{$('loaderText').textContent=t||'Loading...';$('loader').classList.add('on')};
const hide=()=>$('loader').classList.remove('on');
function toast(t,type=''){const el=$('toast');el.textContent=t;el.className='on';if(type)el.classList.add(type);setTimeout(()=>el.className='',2500)}
const openMod=id=>$(id).classList.add('on'),closeMod=id=>$(id).classList.remove('on');
const openMenu=()=>{$('menuDrawer').classList.add('on');$('menuBg').classList.add('on')};
const closeMenu=()=>{$('menuDrawer').classList.remove('on');$('menuBg').classList.remove('on')};
const openCart=()=>{$('cartDrawer').classList.add('on');$('cartBg').classList.add('on')};
const closeCart=()=>{$('cartDrawer').classList.remove('on');$('cartBg').classList.remove('on')};
const fmtD=d=>{if(!d)return'-';try{return new Date(d).toLocaleDateString()}catch{return'-'}};
const fmtDT=d=>{if(!d)return'-';try{return new Date(d).toLocaleString()}catch{return'-'}};
const isoD=d=>{if(!d)return'';try{return new Date(d).toISOString().split('T')[0]}catch{return''}};
const td=()=>new Date().toISOString().split('T')[0];
const moS=()=>{let d=new Date();return new Date(d.getFullYear(),d.getMonth(),1).toISOString().split('T')[0]};

function goTo(pg){const adm=['dash','products','bundles','staff','expenses','reports','customers','stocktake'];if(!admin&&adm.includes(pg)){toast('Access denied','error');return}document.querySelectorAll('.pg').forEach(p=>p.classList.remove('on'));document.querySelectorAll('.topnav-link,.mobnav-btn,.drawer-link').forEach(b=>b.classList.remove('on'));$('pg'+pg.charAt(0).toUpperCase()+pg.slice(1))?.classList.add('on');document.querySelectorAll('[data-pg="'+pg+'"]').forEach(b=>b.classList.add('on'));closeMenu();if(pg==='whatsapp')rWhatsApp();if(pg==='reports')initReports();if(pg==='expenses')rExpenses();if(pg==='customers')rCustomers();if(pg==='stocktake')rStockTakes();if(pg==='bundles')rBundles()}
function pinInput(i){if($('p'+i).value&&i<4)$('p'+(i+1)).focus();if(i===4&&$('p4').value)tryLogin()}
function tryLogin(){const pin=$('p1').value+$('p2').value+$('p3').value+$('p4').value;let u=D.staff.find(s=>String(s.PIN)===pin&&s.Active);if(!u&&pin==='1024')u={Name:'Admin',Role:'Admin'};if(u){user=u;admin=u.Role==='Admin';document.body.classList.toggle('is-admin',admin);$('topAv').textContent=u.Name.charAt(0);$('topNm').textContent=u.Name;$('drAv').textContent=u.Name.charAt(0);$('drNm').textContent=u.Name;$('drBg').textContent=u.Role.toUpperCase();$('login').classList.add('hide');$('app').classList.add('on');goTo(admin?'dash':'pos');toast('Welcome!','success')}else{$('loginErr').classList.add('on');for(let i=1;i<=4;i++)$('p'+i).value='';$('p1').focus()}}
function logout(){user=null;admin=false;document.body.classList.remove('is-admin');$('app').classList.remove('on');$('login').classList.remove('hide');for(let i=1;i<=4;i++)$('p'+i).value='';$('p1').focus()}
function loadData(){show();google.script.run.withSuccessHandler(r=>{hide();if(r){D=r;renderAll();$('p1').focus()}}).withFailureHandler(()=>{hide();toast('Load error','error')}).getAllData()}
function renderAll(){rDash();rPOS();rReceipts();rProducts();rStaff();rCategories();rWABadge();rExpenses();rCustomers();rStockTakes();rBundles()}

function rDash(){const t=td();let tS=0,tP=0;for(const s of D.sales){if(s.Voided)continue;if(isoD(s.Date)===t){tS+=n(s.Total);tP+=n(s.Profit)}}const pending=D.whatsappOrders.filter(o=>o.Status==='Pending').length;const paystackOrders=D.whatsappOrders.filter(o=>o.PaystackRef&&o.Status!=='Cancelled').length;$('dToday').textContent=m(tS);$('dProfit').textContent=m(tP);$('dPending').textContent=pending;$('dPaystack').textContent=paystackOrders}

function rWABadge(){const cnt=D.whatsappOrders.filter(o=>o.Status==='Pending').length;['waBadgeTop','waBadgeMob','waBadgeDr','waBadgeNav'].forEach(id=>{const el=$(id);if(el){el.textContent=cnt;el.style.display=cnt>0?'flex':'none'}})}
function setWAFilter(f){waFilter=f;document.querySelectorAll('#waTabs .tab').forEach(t=>t.classList.remove('on'));event.target.classList.add('on');rWhatsApp()}
function refreshWA(){loadData();toast('Refreshed!','success')}
function rWhatsApp(){const pending=D.whatsappOrders.filter(o=>o.Status==='Pending').length;$('waPendingCount').textContent=pending;const filtered=waFilter==='all'?D.whatsappOrders:D.whatsappOrders.filter(o=>o.Status===waFilter);const sorted=filtered.sort((a,b)=>new Date(b.Date)-new Date(a.Date));$('waOrders').innerHTML=sorted.length?sorted.map(o=>{let items=[];try{items=JSON.parse(o.Items||'[]')}catch{}const statusCls=o.Status.toLowerCase();return`<div class="wa-order ${statusCls}"><div class="wa-order-head"><div><div class="wa-order-id">${o.OrderNo}</div><div class="wa-order-time">${fmtDT(o.Date)}</div></div><button class="btn btn-sm print-btn" onclick="printWAOrder('${o.ID}')">üñ®Ô∏è</button></div><div class="wa-order-badges"><span class="wa-order-status ${statusCls}">${o.Status}</span><span class="wa-payment-status paystack">üí≥ Paystack Paid</span></div><div class="wa-order-customer"><div class="wa-order-avatar">üë§</div><div class="wa-order-info"><h4>${o.CustomerName||'Customer'}</h4><p>${o.CustomerPhone||'No phone'}</p></div></div><div class="wa-order-items">${items.slice(0,3).map(it=>`<div class="wa-order-item"><span>${it.qty}x ${it.name}</span><b>${m(it.lineTotal)}</b></div>`).join('')}${items.length>3?`<div class="wa-order-item"><span>+${items.length-3} more...</span></div>`:''}</div>${o.Address?`<div class="wa-order-address"><span>üìç</span>${o.Address}</div>`:''}${o.PaystackRef?`<div class="wa-paystack-ref">üí≥ Ref: ${o.PaystackRef}</div>`:''}<div class="wa-order-footer"><div class="wa-order-total">${m(o.Total)}</div><div class="action-btns">${o.Status==='Pending'?`<button class="btn btn-success btn-sm" onclick="completeWA('${o.ID}')">‚úÖ Complete</button><button class="btn btn-danger btn-sm" onclick="cancelWA('${o.ID}')">‚ùå</button>`:''}</div></div></div>`}).join(''):'<div class="tbl-empty"><span>üì±</span><p>No orders</p></div>'}
function completeWA(id){if(!confirm('Complete order? Stock will be deducted.'))return;show('Completing...');google.script.run.withSuccessHandler(r=>{hide();if(r?.success){toast('Completed! Receipt: '+r.receiptNo,'success');loadData();if(confirm('Print receipt?'))printReceipt(r.receiptNo)}else toast(r?.error||'Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')}).completeWhatsAppOrder(id,user?.Name||'')}
function cancelWA(id){const reason=prompt('Reason:');if(reason===null)return;show('Cancelling...');google.script.run.withSuccessHandler(r=>{hide();if(r?.success){toast('Cancelled','warning');loadData()}else toast(r?.error||'Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')}).cancelWhatsAppOrder(id,user?.Name||'',reason)}

function rCustomers(){const q=($('custQ')?.value||'').toLowerCase();$('custCount').textContent=D.customers.length;const sorted=D.customers.slice().sort((a,b)=>n(b.TotalSpent)-n(a.TotalSpent)).filter(c=>c.Phone.toLowerCase().includes(q));$('custTbl').innerHTML=sorted.length?sorted.map(c=>`<tr><td><b>${c.Phone}</b></td><td><span class="badge badge-primary">${c.VisitCount}</span></td><td style="font-weight:700;color:var(--success)">${m(c.TotalSpent)}</td><td>${fmtD(c.LastVisit)}</td></tr>`).join(''):'<tr><td colspan="4"><div class="tbl-empty"><span>üë•</span>No customers yet</div></td></tr>'}

function rExpenses(){const mo=moS();let mTotal=0;const sorted=D.expenses.slice().sort((a,b)=>new Date(b.Date)-new Date(a.Date));for(const e of D.expenses)if(isoD(e.Date)>=mo)mTotal+=n(e.Amount);$('expMonthTotal').textContent=m(mTotal);$('expTbl').innerHTML=sorted.length?sorted.map(e=>`<tr><td>${fmtD(e.Date)}</td><td><span class="badge badge-danger">${e.Category}</span></td><td>${e.Description}</td><td style="font-weight:700;color:var(--danger)">${m(e.Amount)}</td><td><button class="btn btn-danger btn-sm" onclick="delExp('${e.ID}')">üóëÔ∏è</button></td></tr>`).join(''):'<tr><td colspan="5"><div class="tbl-empty"><span>üí∏</span>No expenses</div></td></tr>'}
function openExp(){$('expDate').value=td();$('expCat').value='Utilities';$('expDesc').value='';$('expAmt').value='';openMod('expModal')}
function saveExp(){const data={date:$('expDate').value,category:$('expCat').value,description:$('expDesc').value.trim(),amount:n($('expAmt').value)};if(!data.amount){toast('Enter amount','warning');return}show('Saving...');google.script.run.withSuccessHandler(r=>{hide();if(r?.success){closeMod('expModal');loadData();toast('Expense added!','success')}else toast('Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')}).addExpense(data)}
function delExp(id){if(!confirm('Delete expense?'))return;show('Deleting...');google.script.run.withSuccessHandler(()=>{hide();loadData();toast('Deleted!','success')}).deleteExpense(id)}

function rStockTakes(){const sorted=D.stocktakes.slice().sort((a,b)=>new Date(b.Date)-new Date(a.Date));$('stTbl').innerHTML=sorted.length?sorted.map(s=>{let items=[];try{items=JSON.parse(s.Items||'[]')}catch{}return`<tr><td>${fmtD(s.Date)}</td><td><span class="badge badge-primary">${items.length} items</span></td><td>${s.Notes||'-'}</td></tr>`}).join(''):'<tr><td colspan="3"><div class="tbl-empty"><span>üìã</span>No stock takes yet</div></td></tr>'}
function openStockTake(){$('stNotes').value='';$('stItems').innerHTML=D.products.map(p=>`<div class="stock-item"><div class="stock-item-info"><div class="stock-item-name">${p.Name}</div><div class="stock-item-current">Current: ${n(p.Quantity)}</div></div><input type="number" class="stock-item-input" data-id="${p.ID}" value="${n(p.Quantity)}" min="0"></div>`).join('');openMod('stModal')}
function saveStockTake(){const items=[];document.querySelectorAll('.stock-item-input').forEach(inp=>{const id=inp.dataset.id,newQty=n(inp.value),p=D.products.find(x=>x.ID===id);if(p){items.push({productId:id,name:p.Name,oldQty:n(p.Quantity),newQty:newQty});if(newQty!==n(p.Quantity))google.script.run.updateStock(id,newQty)}});show('Saving...');google.script.run.withSuccessHandler(r=>{hide();if(r?.success){closeMod('stModal');loadData();toast('Stock take saved!','success')}else toast('Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')}).addStockTake({items:JSON.stringify(items),notes:$('stNotes').value.trim()})}

function initReports(){const today=new Date(),y=today.getFullYear(),mo=today.getMonth();$('repFrom').value=new Date(y,mo,1).toISOString().split('T')[0];$('repTo').value=today.toISOString().split('T')[0];rReports()}
function rReports(){const from=$('repFrom').value,to=$('repTo').value;let sales=0,profit=0,txn=0,wa=0,whole=0,retail=0,exp=0;for(const s of D.sales){if(s.Voided)continue;const d=isoD(s.Date);if(d>=from&&d<=to){sales+=n(s.Total);profit+=n(s.Profit);txn++;if(s.Type==='WhatsApp')wa+=n(s.Total);else if(s.Type==='Wholesale')whole+=n(s.Total);else retail+=n(s.Total)}}for(const e of D.expenses){const d=isoD(e.Date);if(d>=from&&d<=to)exp+=n(e.Amount)}$('repSales').textContent=m(sales);$('repProfit').textContent=m(profit);$('repExpenses').textContent=m(exp);const net=profit-exp;$('repNet').textContent=m(net);$('repNet').className='value '+(net>=0?'success':'danger');$('repTxn').textContent=txn;$('repWA').textContent=m(wa);$('repWhole').textContent=m(whole);$('repRetail').textContent=m(retail);rWeeklyTrends();rDailyChart();rTopProducts(from,to)}
function rWeeklyTrends(){const weeks=[];const today=new Date();for(let i=7;i>=0;i--){const weekStart=new Date(today);weekStart.setDate(today.getDate()-(i*7)-today.getDay()+(today.getDay()===0?-6:1));const weekEnd=new Date(weekStart);weekEnd.setDate(weekStart.getDate()+6);let sales=0,profit=0,txns=0;for(const s of D.sales){if(s.Voided)continue;const sDate=new Date(s.Date);if(sDate>=weekStart&&sDate<=weekEnd){sales+=n(s.Total);profit+=n(s.Profit);txns++}}weeks.push({start:weekStart,end:weekEnd,label:weekStart.toLocaleDateString('en',{month:'short',day:'numeric'}),sales,profit,txns,isCurrent:i===0})}const maxSales=Math.max(...weeks.map(w=>w.sales),1);$('weeklyChart').innerHTML=weeks.map((w,i)=>{const height=Math.max((w.sales/maxSales)*140,4);const prevWeek=weeks[i-1];const isDown=prevWeek&&w.sales<prevWeek.sales;return`<div class="week-bar ${w.isCurrent?'current':''} ${isDown?'down':''}"><div class="week-bar-value">${w.sales>=1000?(w.sales/1000).toFixed(1)+'k':Math.round(w.sales)}</div><div class="week-bar-fill" style="height:${height}px"></div><div class="week-bar-label">${w.label}</div></div>`}).join('');const thisWeek=weeks[weeks.length-1];const lastWeek=weeks[weeks.length-2];const avgSales=weeks.reduce((a,w)=>a+w.sales,0)/weeks.length;const salesChange=lastWeek.sales>0?((thisWeek.sales-lastWeek.sales)/lastWeek.sales*100):0;const profitChange=lastWeek.profit>0?((thisWeek.profit-lastWeek.profit)/lastWeek.profit*100):0;$('weeklyStats').innerHTML=`<div class="weekly-stat"><div class="weekly-stat-label">This Week Sales</div><div class="weekly-stat-value">${m(thisWeek.sales)}</div><div class="weekly-stat-change ${salesChange>=0?'up':'down'}">${salesChange>=0?'‚Üë':'‚Üì'} ${Math.abs(salesChange).toFixed(1)}%</div></div><div class="weekly-stat"><div class="weekly-stat-label">This Week Profit</div><div class="weekly-stat-value ${thisWeek.profit>=0?'up':'down'}">${m(thisWeek.profit)}</div><div class="weekly-stat-change ${profitChange>=0?'up':'down'}">${profitChange>=0?'‚Üë':'‚Üì'} ${Math.abs(profitChange).toFixed(1)}%</div></div><div class="weekly-stat"><div class="weekly-stat-label">8-Week Average</div><div class="weekly-stat-value">${m(avgSales)}</div><div class="weekly-stat-change">${weeks.reduce((a,w)=>a+w.txns,0)} txns</div></div>`}
function rDailyChart(){const days=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];const today=new Date();const dayOfWeek=today.getDay()||7;const weekStart=new Date(today);weekStart.setDate(today.getDate()-dayOfWeek+1);const dailyData=[];for(let i=0;i<7;i++){const date=new Date(weekStart);date.setDate(weekStart.getDate()+i);const dateStr=isoD(date);let sales=0;for(const s of D.sales){if(s.Voided)continue;if(isoD(s.Date)===dateStr)sales+=n(s.Total)}dailyData.push({day:days[i],date:dateStr,sales,isToday:dateStr===td()})}const maxSales=Math.max(...dailyData.map(d=>d.sales),1);$('dailyChart').innerHTML=dailyData.map(d=>{const height=Math.max((d.sales/maxSales)*100,4);return`<div class="day-bar ${d.isToday?'today':''}"><div class="day-bar-value">${d.sales>=1000?(d.sales/1000).toFixed(1)+'k':Math.round(d.sales)}</div><div class="day-bar-fill" style="height:${height}px"></div><div class="day-bar-label">${d.day}${d.isToday?' ‚Ä¢':''}</div></div>`}).join('')}
function rTopProducts(from,to){const productSales={};for(const s of D.sales){if(s.Voided)continue;const d=isoD(s.Date);if(d<from||d>to)continue;let items=[];try{items=JSON.parse(s.Items||'[]')}catch{}for(const item of items){const name=item.name||'Unknown';if(!productSales[name])productSales[name]={name,qty:0,total:0};productSales[name].qty+=n(item.qty);productSales[name].total+=n(item.lineTotal)}}const sorted=Object.values(productSales).sort((a,b)=>b.total-a.total).slice(0,5);$('topProducts').innerHTML=sorted.length?sorted.map((p,i)=>`<div class="top-product"><div class="top-product-rank ${i===0?'gold':i===1?'silver':i===2?'bronze':''}">${i+1}</div><div class="top-product-info"><div class="top-product-name">${p.name}</div><div class="top-product-qty">${p.qty} sold</div></div><div class="top-product-total">${m(p.total)}</div></div>`).join(''):'<div class="tbl-empty"><span>üì¶</span><p>No sales data</p></div>'}

function rCategories(){const cats=new Set(['all']);D.products.forEach(p=>{if(p.Category)cats.add(p.Category)});$('catFilter').innerHTML=[...cats].map(c=>`<button class="cat-chip${selectedCat===c?' on':''}" onclick="setCat('${c}')">${c==='all'?'üè∑Ô∏è All':c}</button>`).join('')}
function setCat(c){selectedCat=c;rCategories();rPOS()}
function setMode(md){mode=md;$('mdRet').classList.toggle('on',md==='retail');$('mdWho').classList.toggle('on',md==='wholesale');$('mdBun').classList.toggle('on',md==='bundle');rPOS()}

function rPOS(){const q=($('posQ').value||'').toLowerCase();let h='';if(mode==='bundle'){for(const b of D.bundles)if(b.Active&&b.Name.toLowerCase().includes(q))h+=`<div class="product" onclick="addBun('${b.ID}')"><div class="product-img">üéÅ</div><div class="product-name">${b.Name}</div><div class="product-price">${m(b.BundlePrice)}</div><span class="product-stock ok">Bundle</span></div>`}else{for(const p of D.products){if(!p.Name.toLowerCase().includes(q))continue;if(selectedCat!=='all'&&p.Category!==selectedCat)continue;const pr=mode==='wholesale'&&n(p.WholesalePrice)>0?n(p.WholesalePrice):n(p.Price);const qt=n(p.Quantity),cl=qt===0?'out':qt<=5?'low':'ok';const img=p.Image?`<img src="${p.Image}">`:'üì¶';h+=`<div class="product${qt===0?' out':''}" onclick="addProd('${p.ID}')"><div class="product-img">${img}</div><div class="product-name">${p.Name}</div><div class="product-price">${m(pr)}</div><span class="product-stock ${cl}">${qt}</span></div>`}}$('prodGrid').innerHTML=h||'<div class="tbl-empty" style="grid-column:1/-1"><span>üì¶</span>No products</div>'}
function addProd(id){const p=D.products.find(x=>x.ID===id);if(!p||n(p.Quantity)===0)return;const pr=mode==='wholesale'&&n(p.WholesalePrice)>0?n(p.WholesalePrice):n(p.Price);const ex=cart.find(c=>c.productId===id);if(ex){if(ex.qty<n(p.Quantity)){ex.qty++;ex.lineTotal=ex.qty*ex.price}else{toast('Not enough','warning');return}}else cart.push({productId:id,name:p.Name,price:pr,costPrice:n(p.CostPrice),qty:1,lineTotal:pr,image:p.Image||''});rCart();toast('Added!','success')}
function addBun(id){const b=D.bundles.find(x=>x.ID===id);if(!b)return;const its=JSON.parse(b.Products||'[]');let cost=0;for(const it of its){const p=D.products.find(x=>x.ID===it.productId);if(p)cost+=n(p.CostPrice)*n(it.qty)}const ex=cart.find(c=>c.bundleId===id);if(ex){ex.qty++;ex.lineTotal=ex.qty*ex.price}else cart.push({bundleId:id,name:b.Name,price:n(b.BundlePrice),costPrice:cost,qty:1,lineTotal:n(b.BundlePrice),isBundle:true,bundleItems:its});rCart();toast('Added!','success')}

function rCart(){const cnt=cart.reduce((a,c)=>a+c.qty,0);$('cartCnt').textContent=cnt;$('cartBadge').textContent=cnt;$('payBtn').disabled=cnt===0;$('cartBody').innerHTML=cnt?cart.map((c,i)=>{const img=c.isBundle?'üéÅ':(c.image?`<img src="${c.image}">`:'üì¶');return`<div class="cart-item"><div class="cart-item-img">${img}</div><div class="cart-item-info"><div class="cart-item-name">${c.name}</div></div><div class="cart-qty"><button class="cart-qty-btn" onclick="chgQty(${i},-1)">‚àí</button><span class="cart-qty-num">${c.qty}</span><button class="cart-qty-btn" onclick="chgQty(${i},1)">+</button></div><span class="cart-item-total">${m(c.lineTotal)}</span><button class="cart-item-del" onclick="delItem(${i})">‚úï</button></div>`}).join(''):'<div class="cart-empty"><span>üõí</span><p>Empty</p></div>';calcCart();updateHeldBtn()}
function chgQty(i,d){const c=cart[i];if(!c)return;const nq=c.qty+d;if(nq<1){delItem(i);return}if(!c.isBundle){const p=D.products.find(x=>x.ID===c.productId);if(p&&nq>n(p.Quantity)){toast('Not enough','warning');return}}c.qty=nq;c.lineTotal=c.qty*c.price;rCart()}
function delItem(i){cart.splice(i,1);rCart()}
function clearCart(){if(!cart.length)return;if(!confirm('Clear cart?'))return;cart=[];rCart()}
function holdCart(){if(!cart.length){toast('Cart is empty','warning');return}const name=prompt('Customer name or note:','Customer '+(heldCarts.length+1));if(name===null)return;heldCarts.push({id:Date.now(),name:name||'Cart '+(heldCarts.length+1),items:[...cart],phone:$('cartPh').value,discount:n($('cartDisc').value),time:new Date().toLocaleTimeString(),total:cart.reduce((a,c)=>a+c.lineTotal,0)});cart=[];$('cartPh').value='';$('cartDisc').value=0;rCart();updateHeldBtn();toast('Cart held!','success')}
function updateHeldBtn(){const cnt=heldCarts.length;$('heldCnt').textContent=cnt;$('heldBtn').style.display=cnt>0?'inline-flex':'none'}
function openHeldCarts(){if(!heldCarts.length){toast('No held carts','warning');return}$('heldCartsBody').innerHTML=heldCarts.map((h,i)=>`<div class="held-cart"><div class="held-cart-head"><div class="held-cart-name">üìã ${h.name}</div><div class="held-cart-time">${h.time}</div></div><div class="held-cart-items">${h.items.length} item(s)</div><div class="held-cart-total">${m(h.total)}</div><div class="held-cart-actions"><button class="btn btn-success btn-sm" onclick="recallCart(${i})">üì• Recall</button><button class="btn btn-danger btn-sm" onclick="deleteHeldCart(${i})">üóëÔ∏è</button></div></div>`).join('');openMod('heldModal')}
function recallCart(index){if(cart.length&&!confirm('Replace current cart?'))return;const held=heldCarts[index];cart=[...held.items];$('cartPh').value=held.phone||'';$('cartDisc').value=held.discount||0;heldCarts.splice(index,1);updateHeldBtn();rCart();closeMod('heldModal');toast('Cart recalled!','success')}
function deleteHeldCart(index){if(!confirm('Delete held cart?'))return;heldCarts.splice(index,1);updateHeldBtn();heldCarts.length?openHeldCarts():closeMod('heldModal');toast('Deleted!','success')}
function calcCart(){const sub=cart.reduce((a,c)=>a+c.lineTotal,0),d=n($('cartDisc').value);$('cartSub').textContent=m(sub);$('cartTot').textContent=m(Math.max(0,sub-d))}
function openPay(){if(!cart.length)return;$('payMethod').value='Cash';$('payTotal').textContent=m(cart.reduce((a,c)=>a+c.lineTotal,0)-n($('cartDisc').value));openMod('payModal')}
function completeSale(){show('Processing...');const saleData={items:cart,customer:$('cartPh').value.trim()||'Walk-in',payment:$('payMethod').value,discount:n($('cartDisc').value),type:mode==='wholesale'?'Wholesale':'Retail',cashier:user?.Name||''};google.script.run.withSuccessHandler(r=>{hide();if(r?.success){lastSaleData={ReceiptNo:r.receiptNo,Date:new Date().toISOString(),Customer:saleData.customer,Cashier:saleData.cashier,Payment:saleData.payment,Type:saleData.type,Items:JSON.stringify(cart),Total:r.total||cart.reduce((a,c)=>a+c.lineTotal,0)-saleData.discount,Discount:saleData.discount};toast('Sale completed!','success');cart=[];$('cartPh').value='';$('cartDisc').value=0;rCart();closeMod('payModal');closeCart();loadData();if(confirm('Print receipt?'))printLastSale()}else toast('Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')}).recordSale(saleData)}
function rReceipts(){const q=($('rcQ').value||'').toLowerCase();const sorted=D.sales.slice().sort((a,b)=>new Date(b.Date)-new Date(a.Date)).filter(s=>s.ReceiptNo.toLowerCase().includes(q)||s.Customer.toLowerCase().includes(q)).slice(0,50);$('rcTbl').innerHTML=sorted.length?sorted.map(s=>`<tr${s.Voided?' style="opacity:.5"':''}><td><b style="color:var(--primary)">${s.ReceiptNo}</b>${s.Voided?'<span class="badge badge-danger" style="margin-left:6px">VOID</span>':''}</td><td>${fmtD(s.Date)}</td><td>${s.Customer}</td><td><span class="badge badge-${s.Type==='WhatsApp'?'whatsapp':s.Type==='Wholesale'?'warning':'success'}">${s.Type}</span></td><td><b>${m(s.Total)}</b></td><td><button class="btn btn-sm print-btn" onclick="printReceipt('${s.ReceiptNo}')">üñ®Ô∏è</button></td></tr>`).join(''):'<tr><td colspan="6"><div class="tbl-empty"><span>üßæ</span>No receipts</div></td></tr>'}

function rProducts(){const q=($('prQ').value||'').toLowerCase();$('prTbl').innerHTML=D.products.filter(p=>p.Name.toLowerCase().includes(q)).map(p=>{const qt=n(p.Quantity);const img=p.Image?`<img src="${p.Image}" style="width:50px;height:50px;object-fit:cover;border-radius:8px">`:'üì¶';return`<tr><td>${img}</td><td><b>${p.Name}</b><br><small style="color:#94a3b8">${p.Category||'-'}</small></td><td style="color:var(--primary);font-weight:700">${m(p.Price)}</td><td style="font-weight:700;color:${qt===0?'var(--danger)':qt<=5?'var(--warning)':'inherit'}">${qt}</td><td><div class="action-btns"><button class="btn btn-ghost btn-sm" onclick="editPr('${p.ID}')">‚úèÔ∏è</button><button class="btn btn-danger btn-sm" onclick="delPr('${p.ID}')">üóëÔ∏è</button></div></td></tr>`}).join('')||'<tr><td colspan="5"><div class="tbl-empty">No products</div></td></tr>'}
function handleImgUpload(input){const file=input.files[0];if(!file)return;if(file.size>5000000){toast('Max 5MB','warning');return}const reader=new FileReader();reader.onload=e=>{currentImg=e.target.result;$('imgPreview').src=currentImg;$('imgPreview').style.display='block';$('imgPlaceholder').style.display='none';$('imgUploadArea').classList.add('has-img')};reader.readAsDataURL(file)}
function removeImg(){currentImg='';existingImgUrl='';$('prImgInput').value='';$('imgPreview').style.display='none';$('imgPlaceholder').style.display='flex';$('imgUploadArea').classList.remove('has-img')}
function openPr(){$('prModalTitle').textContent='Add Product';$('ePrId').value='';$('prName').value='';$('prCat').value='';$('prCost').value='';$('prPrice').value='';$('prWhole').value='';$('prQty').value='';removeImg();openMod('prModal')}
function editPr(id){const p=D.products.find(x=>x.ID===id);if(!p)return;$('prModalTitle').textContent='Edit';$('ePrId').value=p.ID;$('prName').value=p.Name;$('prCat').value=p.Category||'';$('prCost').value=p.CostPrice;$('prPrice').value=p.Price;$('prWhole').value=p.WholesalePrice||'';$('prQty').value=p.Quantity;if(p.Image){existingImgUrl=p.Image;$('imgPreview').src=p.Image;$('imgPreview').style.display='block';$('imgPlaceholder').style.display='none';$('imgUploadArea').classList.add('has-img')}else removeImg();openMod('prModal')}
function savePr(){const id=$('ePrId').value;const data={name:$('prName').value.trim(),category:$('prCat').value.trim(),costPrice:n($('prCost').value),price:n($('prPrice').value),wholesalePrice:n($('prWhole').value),quantity:n($('prQty').value),image:currentImg||existingImgUrl||''};if(!data.name){toast('Enter name','warning');return}show('Saving...');const fn=id?'updateProduct':'addProduct';google.script.run.withSuccessHandler(r=>{hide();if(r?.success){closeMod('prModal');loadData();toast('Saved!','success')}else toast('Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')})[fn](id||data,id?data:undefined)}
function delPr(id){if(!confirm('Delete?'))return;show('Deleting...');google.script.run.withSuccessHandler(()=>{hide();loadData();toast('Deleted!','success')}).deleteProduct(id)}

function rStaff(){$('sfTbl').innerHTML=D.staff.map(s=>`<tr><td><b>${s.Name}</b></td><td><span class="badge badge-${s.Role==='Admin'?'slate':'success'}">${s.Role}</span></td><td><div class="action-btns"><button class="btn btn-ghost btn-sm" onclick="editSf('${s.ID}')">‚úèÔ∏è</button><button class="btn btn-danger btn-sm" onclick="delSf('${s.ID}')">üóëÔ∏è</button></div></td></tr>`).join('')||'<tr><td colspan="3"><div class="tbl-empty">No staff</div></td></tr>'}
function openSf(){$('sfModalTitle').textContent='Add Staff';$('eSfId').value='';$('sfName').value='';$('sfRole').value='Cashier';$('sfPin').value='';openMod('sfModal')}
function editSf(id){const s=D.staff.find(x=>x.ID===id);if(!s)return;$('sfModalTitle').textContent='Edit';$('eSfId').value=s.ID;$('sfName').value=s.Name;$('sfRole').value=s.Role;$('sfPin').value=s.PIN;openMod('sfModal')}
function saveSf(){const id=$('eSfId').value,data={name:$('sfName').value.trim(),role:$('sfRole').value,pin:$('sfPin').value.trim(),active:true};if(!data.name||data.pin.length!==4){toast('Name & 4-digit PIN required','warning');return}show('Saving...');const fn=id?'updateStaff':'addStaff';google.script.run.withSuccessHandler(r=>{hide();if(r?.success){closeMod('sfModal');loadData();toast('Saved!','success')}else toast('Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')})[fn](id||data,id?data:undefined)}
function delSf(id){if(!confirm('Delete?'))return;show('Deleting...');google.script.run.withSuccessHandler(()=>{hide();loadData();toast('Deleted!','success')}).deleteStaff(id)}

const SHOP_NAME='EVERYTINROOM',SHOP_TAGLINE='& BEDTIME',SHOP_PHONE='0551234567',SHOP_ADDRESS='Accra, Ghana';
function generateReceiptHTML(sale){let items=[];try{items=JSON.parse(sale.Items||'[]')}catch{}const receiptNo=sale.ReceiptNo||'N/A',date=fmtDT(sale.Date),customer=sale.Customer||'Walk-in',cashier=sale.Cashier||'Staff',payment=sale.Payment||'Cash',subtotal=n(sale.Total)+n(sale.Discount),discount=n(sale.Discount),total=n(sale.Total),type=sale.Type||'Retail';return`<div class="receipt-header"><div class="receipt-logo">${SHOP_NAME}</div><div class="receipt-info">${SHOP_TAGLINE}</div><div class="receipt-info">${SHOP_ADDRESS}</div><div class="receipt-info">Tel: ${SHOP_PHONE}</div></div><div class="receipt-title">SALES RECEIPT</div><div class="receipt-meta"><div><span>Receipt:</span><span>${receiptNo}</span></div><div><span>Date:</span><span>${date}</span></div><div><span>Customer:</span><span>${customer}</span></div><div><span>Cashier:</span><span>${cashier}</span></div><div><span>Payment:</span><span>${payment}</span></div><div><span>Type:</span><span>${type}</span></div></div><div class="receipt-items">${items.map(it=>`<div class="receipt-item"><div class="receipt-item-name">${it.name}</div><div class="receipt-item-detail"><span>${it.qty} x ${m(it.price)}</span><span>${m(it.lineTotal)}</span></div></div>`).join('')}</div><div class="receipt-totals"><div class="receipt-row"><span>Subtotal:</span><span>${m(subtotal)}</span></div>${discount>0?`<div class="receipt-row"><span>Discount:</span><span>-${m(discount)}</span></div>`:''}<div class="receipt-row total"><span>TOTAL:</span><span>${m(total)}</span></div></div><div class="receipt-barcode">*${receiptNo}*</div><div class="receipt-footer"><p>Thank you for shopping with us!</p><p>Goods sold are not returnable</p></div>`}
function printReceipt(receiptNo){const sale=D.sales.find(s=>s.ReceiptNo===receiptNo);if(!sale){toast('Receipt not found','error');return}$('receiptContent').innerHTML=generateReceiptHTML(sale);$('printReceipt').classList.add('preview')}
function printLastSale(){if(!lastSaleData){toast('No recent sale','error');return}$('receiptContent').innerHTML=generateReceiptHTML(lastSaleData);$('printReceipt').classList.add('preview')}
function printWAOrder(orderId){const order=D.whatsappOrders.find(o=>o.ID===orderId);if(!order){toast('Order not found','error');return}let items=[];try{items=JSON.parse(order.Items||'[]')}catch{}const html=`<div class="receipt-header"><div class="receipt-logo">${SHOP_NAME}</div><div class="receipt-info">${SHOP_TAGLINE}</div><div class="receipt-info">${SHOP_ADDRESS}</div><div class="receipt-info">Tel: ${SHOP_PHONE}</div></div><div class="receipt-title">üì± WHATSAPP ORDER</div><div class="receipt-meta"><div><span>Order:</span><span>${order.OrderNo}</span></div><div><span>Date:</span><span>${fmtDT(order.Date)}</span></div><div><span>Customer:</span><span>${order.CustomerName||'Customer'}</span></div><div><span>Phone:</span><span>${order.CustomerPhone||'-'}</span></div><div><span>Status:</span><span>${order.Status}</span></div><div><span>Payment:</span><span>üí≥ Paystack Paid</span></div>${order.PaystackRef?`<div><span>Ref:</span><span>${order.PaystackRef}</span></div>`:''}</div>${order.Address?`<div style="margin:2mm 0;padding:2mm;border:1px dashed #000;font-size:11px"><strong>üìç Delivery:</strong><br>${order.Address}</div>`:''}<div class="receipt-items">${items.map(it=>`<div class="receipt-item"><div class="receipt-item-name">${it.name}</div><div class="receipt-item-detail"><span>${it.qty} x ${m(it.price||0)}</span><span>${m(it.lineTotal||0)}</span></div></div>`).join('')}</div><div class="receipt-totals">${n(order.DeliveryFee)>0?`<div class="receipt-row"><span>Delivery:</span><span>${m(order.DeliveryFee)}</span></div>`:''}<div class="receipt-row total"><span>TOTAL:</span><span>${m(order.Total)}</span></div></div><div class="receipt-footer"><p>WhatsApp Order - Paystack Paid</p></div>`;$('receiptContent').innerHTML=html;$('printReceipt').classList.add('preview')}
function doPrint(){window.print()}
function closePreview(){$('printReceipt').classList.remove('preview')}
let lastSaleData=null;
let bundleItems=[];
function rBundles(){$('bunTbl').innerHTML=D.bundles.length?D.bundles.map(b=>{let products=[];try{products=JSON.parse(b.Products||'[]')}catch{}const productNames=products.map(p=>{const prod=D.products.find(x=>x.ID===p.productId);return prod?`${p.qty}x ${prod.Name}`:`${p.qty}x Unknown`}).join(', ');const retailTotal=products.reduce((sum,p)=>{const prod=D.products.find(x=>x.ID===p.productId);return sum+(prod?n(prod.Price)*n(p.qty):0)},0);const savings=retailTotal-n(b.BundlePrice);return`<tr><td><b>${b.Name}</b></td><td><small style="color:#64748b">${productNames||'No products'}</small></td><td style="color:var(--primary);font-weight:700">${m(b.BundlePrice)}</td><td style="color:var(--success);font-weight:600">${savings>0?'Save '+m(savings):'-'}</td><td><span class="badge badge-${b.Active?'success':'danger'}">${b.Active?'Active':'Inactive'}</span></td><td><div class="action-btns"><button class="btn btn-ghost btn-sm" onclick="editBun('${b.ID}')">‚úèÔ∏è</button><button class="btn btn-danger btn-sm" onclick="delBun('${b.ID}')">üóëÔ∏è</button></div></td></tr>`}).join(''):'<tr><td colspan="6"><div class="tbl-empty"><span>üéÅ</span><p>No bundles yet</p></div></td></tr>'}
function openBun(){$('bunModalTitle').textContent='Create Bundle';$('eBunId').value='';$('bunName').value='';$('bunPrice').value='';$('bunActive').value='true';bundleItems=[];updateBunProdSelect();rBundleItems();openMod('bunModal')}
function editBun(id){const b=D.bundles.find(x=>x.ID===id);if(!b)return;$('bunModalTitle').textContent='Edit Bundle';$('eBunId').value=b.ID;$('bunName').value=b.Name;$('bunPrice').value=b.BundlePrice;$('bunActive').value=b.Active?'true':'false';try{bundleItems=JSON.parse(b.Products||'[]')}catch{bundleItems=[]}updateBunProdSelect();rBundleItems();openMod('bunModal')}
function updateBunProdSelect(){$('bunProdSelect').innerHTML='<option value="">-- Select Product --</option>'+D.products.map(p=>`<option value="${p.ID}">${p.Name} (${m(p.Price)})</option>`).join('')}
function addToBundleList(){const sel=$('bunProdSelect'),prodId=sel.value;if(!prodId)return;const existing=bundleItems.find(x=>x.productId===prodId);if(existing)existing.qty++;else bundleItems.push({productId:prodId,qty:1});sel.value='';rBundleItems()}
function rBundleItems(){if(!bundleItems.length){$('bunItemsList').innerHTML='<div class="bun-empty">No products added yet</div>';$('bunRetailTotal').textContent='';return}let retailTotal=0;$('bunItemsList').innerHTML=bundleItems.map((item,i)=>{const prod=D.products.find(x=>x.ID===item.productId);if(!prod)return'';retailTotal+=n(prod.Price)*n(item.qty);return`<div class="bun-item"><div class="bun-item-name">${prod.Name}</div><div class="bun-item-price">${m(prod.Price)} each</div><div class="bun-item-qty"><input type="number" value="${item.qty}" min="1" onchange="updateBunItemQty(${i},this.value)"></div><button class="bun-item-del" onclick="removeBunItem(${i})">‚úï</button></div>`}).join('');$('bunRetailTotal').innerHTML=`Retail Total: <b>${m(retailTotal)}</b> ${n($('bunPrice').value)>0?`| Savings: <b style="color:var(--success)">${m(retailTotal-n($('bunPrice').value))}</b>`:''}`}
function updateBunItemQty(index,qty){if(n(qty)<1)qty=1;bundleItems[index].qty=n(qty);rBundleItems()}
function removeBunItem(index){bundleItems.splice(index,1);rBundleItems()}
function saveBun(){const id=$('eBunId').value,data={name:$('bunName').value.trim(),bundlePrice:n($('bunPrice').value),products:JSON.stringify(bundleItems),active:$('bunActive').value==='true'};if(!data.name){toast('Enter bundle name','warning');return}if(!bundleItems.length){toast('Add products to bundle','warning');return}if(!data.bundlePrice){toast('Enter bundle price','warning');return}show('Saving...');const fn=id?'updateBundle':'addBundle';google.script.run.withSuccessHandler(r=>{hide();if(r?.success){closeMod('bunModal');loadData();toast('Bundle saved!','success')}else toast(r?.error||'Error','error')}).withFailureHandler(()=>{hide();toast('Error','error')})[fn](id||data,id?data:undefined)}
function delBun(id){if(!confirm('Delete this bundle?'))return;show('Deleting...');google.script.run.withSuccessHandler(()=>{hide();loadData();toast('Deleted!','success')}).deleteBundle(id)}
document.addEventListener('DOMContentLoaded',()=>{const bunPriceInput=$('bunPrice');if(bunPriceInput)bunPriceInput.addEventListener('input',rBundleItems)});
document.addEventListener('DOMContentLoaded',loadData);
setInterval(()=>{google.script.run.withSuccessHandler(r=>{if(r){D=r;renderAll()}}).getAllData()},30000);
document.addEventListener('visibilitychange',()=>{if(!document.hidden)loadData()});
window.addEventListener('focus',loadData);
</script>
</body>
</html>
